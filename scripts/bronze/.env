# =======================
# Snowflake Credentials
# =======================
SNOW_ACCOUNT=AVDMGQP-WJ80905
SNOW_USER=PREMBHARGAV
SNOW_ROLE=SYSADMIN
SNOW_WAREHOUSE=COMPUTE_WH
SNOW_DATABASE=DATAWAREHOUSE
SNOW_SCHEMA=BRONZE

# =======================
# Stages
# =======================
CRM_STAGE=bronze.crm_stage
ERP_STAGE=bronze.erp_stage

# =======================
# CSV File Paths
# =======================
CRM_CUST_INFO="C:/sql/dwh_project/datasets/source_crm/cust_info.csv"
CRM_PRD_INFO="C:/sql/dwh_project/datasets/source_crm/prd_info.csv"
CRM_SALES_DETAILS="C:/sql/dwh_project/datasets/source_crm/sales_details.csv"

ERP_LOC_A101="C:/sql/dwh_project/datasets/source_erp/loc_a101.csv"
ERP_CUST_AZ12="C:/sql/dwh_project/datasets/source_erp/cust_az12.csv"
ERP_PX_CAT_G1V2="C:/sql/dwh_project/datasets/source_erp/px_cat_g1v2.csv"

# =======================
# SNOWSQL Reusable Commands
# =======================

# Create Stages
CREATE_CRM_STAGE=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "USE ROLE %SNOW_ROLE%; USE WAREHOUSE %SNOW_WAREHOUSE%; USE DATABASE %SNOW_DATABASE%; USE SCHEMA %SNOW_SCHEMA%; CREATE OR REPLACE STAGE %CRM_STAGE% FILE_FORMAT = (TYPE = CSV FIELD_OPTIONALLY_ENCLOSED_BY='\"' SKIP_HEADER=1);"

CREATE_ERP_STAGE=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "USE ROLE %SNOW_ROLE%; USE WAREHOUSE %SNOW_WAREHOUSE%; USE DATABASE %SNOW_DATABASE%; USE SCHEMA %SNOW_SCHEMA%; CREATE OR REPLACE STAGE %ERP_STAGE% FILE_FORMAT = (TYPE = CSV FIELD_OPTIONALLY_ENCLOSED_BY='\"' SKIP_HEADER=1);"

# Upload CRM Files
UPLOAD_CRM_CUST_INFO=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "USE DATABASE %SNOW_DATABASE%; USE SCHEMA %SNOW_SCHEMA%; PUT 'file:///%CRM_CUST_INFO%' @%CRM_STAGE% AUTO_COMPRESS=TRUE;"

UPLOAD_CRM_PRD_INFO=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "USE DATABASE %SNOW_DATABASE%; USE SCHEMA %SNOW_SCHEMA%; PUT 'file:///%CRM_PRD_INFO%' @%CRM_STAGE% AUTO_COMPRESS=TRUE;"

UPLOAD_CRM_SALES_DETAILS=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "USE DATABASE %SNOW_DATABASE%; USE SCHEMA %SNOW_SCHEMA%; PUT 'file:///%CRM_SALES_DETAILS%' @%CRM_STAGE% AUTO_COMPRESS=TRUE;"

# Upload ERP Files
UPLOAD_ERP_LOC_A101=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "USE DATABASE %SNOW_DATABASE%; USE SCHEMA %SNOW_SCHEMA%; PUT 'file:///%ERP_LOC_A101%' @%ERP_STAGE% AUTO_COMPRESS=TRUE;"

UPLOAD_ERP_CUST_AZ12=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "USE DATABASE %SNOW_DATABASE%; USE SCHEMA %SNOW_SCHEMA%; PUT 'file:///%ERP_CUST_AZ12%' @%ERP_STAGE% AUTO_COMPRESS=TRUE;"

UPLOAD_ERP_PX_CAT_G1V2=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "USE DATABASE %SNOW_DATABASE%; USE SCHEMA %SNOW_SCHEMA%; PUT 'file:///%ERP_PX_CAT_G1V2%' @%ERP_STAGE% AUTO_COMPRESS=TRUE;"

# Run Bronze Loader
RUN_BRONZE_LOAD=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "USE DATABASE %SNOW_DATABASE%; USE SCHEMA %SNOW_SCHEMA%; CALL bronze.load_bronze();"

# Verify Loads
VERIFY_CRM_CUST_INFO=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "SELECT COUNT(*) AS row_count FROM bronze.crm_cust_info;"

VERIFY_CRM_PRD_INFO=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "SELECT COUNT(*) AS row_count FROM bronze.crm_prd_info;"

VERIFY_CRM_SALES_DETAILS=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "SELECT COUNT(*) AS row_count FROM bronze.crm_sales_details;"

VERIFY_ERP_LOC_A101=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "SELECT COUNT(*) AS row_count FROM bronze.erp_loc_a101;"

VERIFY_ERP_CUST_AZ12=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "SELECT COUNT(*) AS row_count FROM bronze.erp_cust_az12;"

VERIFY_ERP_PX_CAT_G1V2=snowsql -a %SNOW_ACCOUNT% -u %SNOW_USER% -q "SELECT COUNT(*) AS row_count FROM bronze.erp_px_cat_g1v2;"

